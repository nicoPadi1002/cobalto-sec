---
title: 'Pentest de laboratorio: Metasploitable 2 (guÃƒÆ’Ã‚Â­a paso a paso)'
date: '2025-09-02'
lastmod: '2025-09-02'
summary: 'Pentest de laboratorio a Metasploitable 2: de reconocimiento a RCE en ~32 minutos. 10 hallazgos (2 crÃƒÆ’Ã‚Â­ticos). GuÃƒÆ’Ã‚Â­a reproducible y mapa de mitigaciÃƒÆ’Ã‚Â³n.'
tags:
  [
    'pentest',
    'lab',
    'metasploitable-2',
    'vsftpd',
    'ingreslock',
    'tomcat',
    'mysql',
    'smb',
    'nfs',
    'vnc',
    'x11',
  ]
draft: true
authors: ['nico-padin']
images: ['/static/images/og-default.png']
---

_Aviso: datos anonimizados con fines educativos y de portafolio. Toda prueba debe realizarse en entornos controlados y con autorizaciÃƒÆ’Ã‚Â³n explÃƒÆ’Ã‚Â­cita._

## Resumen ejecutivo (TL;DR)

- **Impacto:** acceso inicial y RCE como **root** (vsftpd 2.3.4 backdoor) + bindshell en 1524/tcp; acceso administrativo a Tomcat y MySQL.
- **CrÃƒÆ’Ã‚Â­ticos/Altos:** 2 crÃƒÆ’Ã‚Â­ticos, 5 altos (total 10).
- **TTFI:** ~32 minutos (desde escaneo consolidado hasta primer compromiso documentado).
- **Causas raÃƒÆ’Ã‚Â­z:** servicios inseguros por defecto, credenciales por defecto/sin contraseÃƒÆ’Ã‚Â±a, exposiciÃƒÆ’Ã‚Â³n de servicios legacy.
- **Acciones ahora:** retirar vsftpd 2.3.4, cerrar Ingreslock 1524, asegurar Tomcat/MySQL, restringir SMB/NFS, cerrar X11.

## Pre-engagement y legal/operativo

- **AutorizaciÃƒÆ’Ã‚Â³n:** laboratorio propio/CTF (Metasploitable 2).
- **RoE:** no destructivo, sin DoS, captura mÃƒÆ’Ã‚Â­nima de datos, horario America/Argentina/Cordoba.
- **Safe-harbor:** VM pÃƒÆ’Ã‚Âºblica de entrenamiento.

## Contexto y alcance

- **Objetivo:** evaluar superficie y vectorizar acceso inicial sobre **Metasploitable 2** en red aislada.
- **Target:** `192.168.0.52` (red privada de laboratorio).
- **In-scope:** host ÃƒÆ’Ã‚Âºnico (servicios TCP detectados por Nmap).
- **Out-of-scope:** fuerza bruta extendida, pivoteo fuera del segmento de laboratorio.
- **Supuestos:** credenciales por defecto presentes; sin controles compensatorios.
- **Exit criteria:** PoC reproducible de acceso inicial + recomendaciones.

## MetodologÃƒÆ’Ã‚Â­a

Recon ÃƒÂ¢Ã¢â‚¬Â Ã¢â‚¬â„¢ EnumeraciÃƒÆ’Ã‚Â³n de servicios ÃƒÂ¢Ã¢â‚¬Â Ã¢â‚¬â„¢ ExplotaciÃƒÆ’Ã‚Â³n ÃƒÂ¢Ã¢â‚¬Â Ã¢â‚¬â„¢ Post-ex ÃƒÂ¢Ã¢â‚¬Â Ã¢â‚¬â„¢ ValidaciÃƒÆ’Ã‚Â³n (referencias: ATT&CK, WSTG selectivo).

## Timeline del ejercicio

- **2025-09-02 09:02:30 -0300**: Reconocimiento/escaneo inicial (Nmap, banners).
- **2025-09-02 09:34:40 -0300**: ExplotaciÃƒÆ’Ã‚Â³n inicial (vsftpd 2.3.4 backdoor ÃƒÂ¢Ã¢â‚¬Â Ã¢â‚¬â„¢ RCE root).  
  **TTFI:** ~32 minutos.

## Mapa de servicios y puertos (resumen)

|   Puerto | Servicio           | ObservaciÃƒÆ’Ã‚Â³n clave                       |
| -------: | ------------------ | ---------------------------------------------- |
|   21/tcp | FTP (vsftpd 2.3.4) | Backdoor CVE-2011-2523 ÃƒÂ¢Ã¢â‚¬Â Ã¢â‚¬â„¢ RCE |
| 1524/tcp | Ingreslock         | Bindshell root expuesto                        |
| 3306/tcp | MySQL 5.0.51a      | `root` sin contraseÃƒÆ’Ã‚Â±a, sin TLS          |
| 8180/tcp | HTTP Tomcat        | `/manager/html` con `tomcat:tomcat`            |
|  445/tcp | SMB                | Share `//tmp` anÃƒÆ’Ã‚Â³nimo RW                |
| 2049/tcp | NFS                | Export `/` con wildcard                        |
| 5900/tcp | VNC 3.x            | Requiere pass (exposiciÃƒÆ’Ã‚Â³n)              |
| 6000/tcp | X11                | Servidor X abierto                             |
| 1099/tcp | RMI Registry       | Accesible sin restricciones                    |
| 5432/tcp | PostgreSQL         | Requiere auth; SSL legacy                      |

## Resultados (Dashboard/KPIs)

| KPI               | Valor |
| ----------------- | ----- |
| Hallazgos totales | 10    |
| CrÃƒÆ’Ã‚Â­ticos   | 2     |
| Altos             | 5     |
| Medios            | 2     |
| Info              | 1     |
| TTFI (min)        | 32    |

## Cobertura de pruebas

| ÃƒÆ’Ã‚Ârea              | Estado                  |
| ----------------------- | ----------------------- |
| Reconocimiento          | Completo                |
| ExplotaciÃƒÆ’Ã‚Â³n      | Completo                |
| Post-explotaciÃƒÆ’Ã‚Â³n | Completo                |
| WSTG/ASVS (apps web)    | N/A (VM multi-servicio) |

## Hallazgos destacados (resumen)

- **FTP_VSFTPD_234_BACKDOOR** ÃƒÂ¢Ã¢â€šÂ¬Ã¢â‚¬Â ftp:21 Ãƒâ€šÃ‚Â· _RCE uid=0 vÃƒÆ’Ã‚Â­a 6200 (marcador presente)_
- **INGRESLOCK_1524_BINDSHELL** ÃƒÂ¢Ã¢â€šÂ¬Ã¢â‚¬Â 1524/tcp Ãƒâ€šÃ‚Â· _Bindshell root (id/whoami/uname capturados)_

## Hallazgos (detalle)

### vsftpd 2.3.4 backdoor (RCE)

- **ID:** `FTP_VSFTPD_234_BACKDOOR`
- **Severidad:** Critical
- **Servicio:** ftp:21
- **CVE:** CVE-2011-2523
- **DescripciÃƒÆ’Ã‚Â³n/PoC rÃƒÆ’Ã‚Â¡pida:** RCE uid=0 vÃƒÆ’Ã‚Â­a 6200/tcp tras login malformado.  
  **RecomendaciÃƒÆ’Ã‚Â³n:** retirar o actualizar vsftpd; cerrar 6200/tcp; mÃƒÆ’Ã‚Â­nimo TLS + credenciales robustas.  
  **ATT&CK:** T1210

### Bindshell en 1524/tcp (ingreslock)

- **ID:** `INGRESLOCK_1524_BINDSHELL`
- **Severidad:** Critical
- **Servicio:** ingreslock:1524
- **DescripciÃƒÆ’Ã‚Â³n/PoC rÃƒÆ’Ã‚Â¡pida:** acceso root por bindshell (validado con id/whoami/uname).  
  **RecomendaciÃƒÆ’Ã‚Â³n:** deshabilitar servicio/xinetd; bloquear 1524/tcp; revisar imÃƒÆ’Ã‚Â¡genes base.  
  **ATT&CK:** T1210

### MySQL root sin contraseÃƒÆ’Ã‚Â±a

- **ID:** `MYSQL_ROOT_NOAUTH`
- **Severidad:** High
- **Servicio:** mysql:3306
- **DescripciÃƒÆ’Ã‚Â³n/PoC rÃƒÆ’Ã‚Â¡pida:** root sin contraseÃƒÆ’Ã‚Â±a (5.0.51a), sin TLS.  
  **RecomendaciÃƒÆ’Ã‚Â³n:** establecer pass fuerte, habilitar TLS, restringir bind-address/ACL.  
  **CWE:** CWE-287 Ãƒâ€šÃ‚Â· **ATT&CK:** T1078

### Tomcat Manager con credenciales por defecto

- **ID:** `TOMCAT_MANAGER_DEFAULT_CREDS`
- **Severidad:** High
- **Servicio:** http-tomcat:8180
- **DescripciÃƒÆ’Ã‚Â³n/PoC rÃƒÆ’Ã‚Â¡pida:** acceso a `/manager/html` con `tomcat:tomcat`.  
  **RecomendaciÃƒÆ’Ã‚Â³n:** eliminar usuario por defecto, rotar credenciales, bloquear Manager por IP o retirar app.  
  **CWE:** CWE-798 Ãƒâ€šÃ‚Â· **ATT&CK:** T1078

### SMB share //tmp anÃƒÆ’Ã‚Â³nimo RW

- **ID:** `SMB_ANON_RW_TMP`
- **Severidad:** High
- **Servicio:** smb:445
- **DescripciÃƒÆ’Ã‚Â³n/PoC rÃƒÆ’Ã‚Â¡pida:** compartido `//tmp` con escritura anÃƒÆ’Ã‚Â³nima.  
  **RecomendaciÃƒÆ’Ã‚Â³n:** deshabilitar guest, mÃƒÆ’Ã‚Â­nimos permisos, firma SMB, cerrar share.  
  **CWE:** CWE-276 Ãƒâ€šÃ‚Â· **ATT&CK:** T1078

### NFS exporta '/' con wildcard

- **ID:** `NFS_EXPORT_ROOT_WILDCARD`
- **Severidad:** High
- **Servicio:** nfs:2049
- **DescripciÃƒÆ’Ã‚Â³n/PoC rÃƒÆ’Ã‚Â¡pida:** export de `/` abierto (wildcard).  
  **RecomendaciÃƒÆ’Ã‚Â³n:** exportar solo paths necesarios a hosts especÃƒÆ’Ã‚Â­ficos, habilitar `root_squash`, firewall.  
  **CWE:** CWE-276

### VNC requiere autenticaciÃƒÆ’Ã‚Â³n (exposiciÃƒÆ’Ã‚Â³n)

- **ID:** `VNC_REQUIRES_AUTH`
- **Severidad:** Medium
- **Servicio:** vnc:5900
- **DescripciÃƒÆ’Ã‚Â³n/PoC rÃƒÆ’Ã‚Â¡pida:** VNC 3.x visible; requiere pass (no probado bruteforce).  
  **RecomendaciÃƒÆ’Ã‚Â³n:** despublicar VNC o tunelizar; endurecer cifrado y lockout.

### X11 abierto en 6000/tcp

- **ID:** `X11_OPEN`
- **Severidad:** High
- **Servicio:** x11:6000
- **DescripciÃƒÆ’Ã‚Â³n/PoC rÃƒÆ’Ã‚Â¡pida:** servidor X expuesto.  
  **RecomendaciÃƒÆ’Ã‚Â³n:** cerrar 6000/tcp o bind a localhost; usar `-nolisten tcp`.

### RMI Registry accesible

- **ID:** `RMI_REGISTRY_OPEN`
- **Severidad:** Medium
- **Servicio:** rmi:1099
- **DescripciÃƒÆ’Ã‚Â³n/PoC rÃƒÆ’Ã‚Â¡pida:** rmiregistry sin restricciones.  
  **RecomendaciÃƒÆ’Ã‚Â³n:** limitar por ACL/firewall y auditar deserializaciÃƒÆ’Ã‚Â³n.

### PostgreSQL (info)

- **ID:** `POSTGRES_SSL_AUTH_REQUIRED`
- **Severidad:** Info
- **Servicio:** postgres:5432
- **DescripciÃƒÆ’Ã‚Â³n/PoC rÃƒÆ’Ã‚Â¡pida:** requiere autenticaciÃƒÆ’Ã‚Â³n; cliente reportÃƒÆ’Ã‚Â³ incompatibilidad SSL.  
  **RecomendaciÃƒÆ’Ã‚Â³n:** forzar SSL moderno; revisar polÃƒÆ’Ã‚Â­ticas de usuarios.

## Credenciales crackeadas (laboratorio)

_Nota: credenciales expuestas solo para fines educativos en VM de laboratorio._

```text
klog:123456789
service:service
sys:batman
```

## Recomendaciones priorizadas (Roadmap)

**0ÃƒÂ¢Ã¢â€šÂ¬Ã¢â‚¬Å“30 dÃƒÆ’Ã‚Â­as**

- Retirar vsftpd 2.3.4 (CVE-2011-2523). Verificar que **6200/tcp** no se abra ante logins malformados.
- Deshabilitar **ingreslock 1524/tcp**.
- Eliminar `tomcat:tomcat` y bloquear `/manager/html`.
- Establecer contraseÃƒÆ’Ã‚Â±a fuerte para **root MySQL** y forzar TLS.
- Cerrar **X11 6000/tcp** o bind a `localhost`.
- Restringir **SMB** (sin anÃƒÆ’Ã‚Â³nimo RW) y **NFS** (sin wildcard `/`).

**30ÃƒÂ¢Ã¢â€šÂ¬Ã¢â‚¬Å“90 dÃƒÆ’Ã‚Â­as**

- Revisar exposiciÃƒÆ’Ã‚Â³n de **RMI** y **VNC** (ACL/tÃƒÆ’Ã‚Âºneles). Endurecer banners.
- Inventariar y retirar servicios legacy no utilizados.

**>90 dÃƒÆ’Ã‚Â­as**

- Automatizar chequeos de configuraciÃƒÆ’Ã‚Â³n (CIS) y escaneo continuo en entornos de laboratorio.

## Control documental

- **Doc ID (SID):** b2e62796-5eeb-4836-944f-42d3631841ba
- **Fechas clave:** scan `2025-09-02T09:02:30-0300`, exploit `2025-09-02T09:34:40-0300`.
- **ClasificaciÃƒÆ’Ã‚Â³n:** PÃƒÆ’Ã‚Âºblico Ãƒâ€šÃ‚Â· Educativo (lab)
- **DistribuciÃƒÆ’Ã‚Â³n:** Blog Cobalto Sec
